STKSEG SEGMENT
    DW 32 DUP(0)
STKSEG ENDS

DATASEG SEGMENT
    YEARS DB '1975','1976','1977','1978','1979','1980','1981','1982','1983','1984','1985','1986','1987','1988','1989','1990','1991','1992','1993','1994','1995'
    INCOMES DD 16,22,382,1356,2390,8000,16000,24486,50065,97479,140417,197514,345980,590827,803530,1183000,1843000,2759000,3753000,4649000,5937000
    EMPLOYEES DW 3,7,9,13,28,38,130,220,476,778,1001,1442,2258,2793,4037,5635,8226,11542,14430,15257,17800
DATASEG ENDS

TABLE SEGMENT
    DB 21 DUP('year summ ne ??')
TABLE ENDS

CODESEG SEGMENT
    ASSUME CS: CODESEG, DS: DATASEG, ES:TABLE
    EXTRN DISPLAY_NUMBER: FAR, DISPLAY_TAB: FAR, DISPLAY_NEWLINE: FAR

MAIN_PROC PROC FAR
    MOV AX, DATASEG
    MOV DS, AX
    MOV AX, TABLE
    MOV ES, AX
    MOV CX, 21
    MOV SI, OFFSET YEARS
    MOV DI, 0

COPY_YEARS_LOOP:
    MOVSB
    MOVSB
    MOVSB
    MOVSB
    ADD DI, 12
    LOOP COPY_YEARS_LOOP
    MOV CX, 21
    MOV SI, OFFSET INCOMES
    MOV DI, 5

COPY_INCOMES_LOOP:
    MOV AX, [SI]
    MOV DX, [SI + 2]
    MOV ES:[DI], AX
    MOV ES:[DI + 2], DX
    ADD DI, 16
    ADD SI, 4
    LOOP COPY_INCOMES_LOOP
    MOV CX, 21
    MOV SI, OFFSET EMPLOYEES
    MOV DI, 10

COPY_EMPLOYEES_LOOP:
    MOV AX, [SI]
    MOV ES:[DI], AX
    ADD DI, 16
    ADD SI, 2
    LOOP COPY_EMPLOYEES_LOOP
    MOV CX, 21
    MOV BX, 13
    MOV SI, OFFSET INCOMES
    MOV DI, OFFSET EMPLOYEES

CALCULATE_AVERAGES_LOOP:
    PUSH BX
    MOV AX, [SI]
    MOV DX, [SI + 2]
    ADD SI, 4
    MOV BX, [DI]
    ADD DI, 2
    DIV BX
    POP BX
    PUSH DI
    MOV DI, BX
    MOV ES:[DI], AX
    ADD DI, 16
    MOV BX, DI
    POP DI
    LOOP CALCULATE_AVERAGES_LOOP
    MOV BX, 21
    MOV SI, 0
    MOV AX, TABLE
    MOV DS, AX

PRINT_TABLE_LOOP:
    CALL DISPLAY_TAB
    MOV CX, 4

PRINT_YEAR:
    MOV DL, [SI]
    MOV AH, 02H
    INT 21H
    INC SI
    LOOP PRINT_YEAR
    CALL DISPLAY_TAB
    CALL DISPLAY_TAB
    CALL DISPLAY_TAB
    INC SI
    MOV AX, [SI]
    ADD SI, 2
    MOV DX, [SI]
    ADD SI, 2
    CALL DISPLAY_NUMBER
    CALL DISPLAY_TAB
    CALL DISPLAY_TAB
    INC SI
    MOV AX, [SI]
    MOV DX, 0
    ADD SI, 2
    CALL DISPLAY_NUMBER
    CALL DISPLAY_TAB
    CALL DISPLAY_TAB
    INC SI
    MOV AX, [SI]
    MOV DX, 0
    ADD SI, 2
    CALL DISPLAY_NUMBER
    INC SI
    CALL DISPLAY_NEWLINE
    DEC BX
    JNZ PRINT_TABLE_LOOP
    MOV AX, 4C00H
    INT 21H

MAIN_PROC ENDP

CODESEG ENDS

END MAIN_PROC